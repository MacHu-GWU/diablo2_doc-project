.. _es对各种伤害的吸收顺序:

es对各种伤害的吸收顺序
===============================================================================
先注明一下：ES表示能量护盾，TK表示心灵感应。

心灵感应给能量互盾的加成是消耗魔法上的。

- 0级的时候，1life要消耗2mana，tk每投资一点，就减少0.0625mana
- 8级tk的时候，1life消耗1.5mana
- 16级tk的时候，1life消耗1mana

抵消1点伤害需要的 ``mana = (32 - 心灵传动的等级) * 0.0625``

es的计算发生在因角色而造成的伤害改变之后，如pvp 的17%伤害惩罚

es计算完后才计算 伤害降低抗性吸收等属性， es不能吸收毒伤害

es在吸收伤害顺序上是这样的，先吸收物理伤害，如果法力还没扣完，再吸收火伤害，然后闪电，然后冰,最后吸收魔法伤害。

注：在纯元素伤害上，计算按正常顺序。

测试环境 tcp/ip, 官方mod, 测试char  sor,  能量护吨lvl35, 90%法力吸收伤害，心灵传动16级，1点法力吸收1点伤害。

::

    测试1
    bar 169.xx~170物理伤害+170火焰伤害，
    sor 100点法力开盾，带上50%抗符，以下数据都再满法力开盾下测试
    sor血 掉血
    4309    155
    4154    155
    3999    155
    3844    155
    3690    154


猜想能量护盾对物理伤害可能优先吸收，10%扣到血上也就是17点物理伤害，17点火伤害，153点物理 和153火伤害扣在法力上，法力优先扣除物理伤害，153-100还剩 53点物理伤害和153点火伤害，加上上面扣到血的10%伤害，总共扣到血70物理伤害，170火伤害，下面开始计算抗性了，170火伤害*50%+70物理伤害= 155。

如果不是全吸收的物理伤害，最终掉血将超过155

可见法力抵消的的全是物理伤害。

::

    测试2
    bar 同上
    sor 换dr50% 如果能量盾抵消的全是物理伤害的话,剩下70点物理和170火焰，
    最后结果为70*50%+170=205
    sor血    掉血
    3455    205
    3280    205
    3075    205
    2870    205
    2665    205
    2460    205

结果完全符合，确实全部抵消了物理伤害。

::

    测试3
    bar 物理伤害169.xx~170, 冰火各170
    sor 200法力开盾 ， 火吸收200
    sor血    掉血
    2740    64
    2676    64
    2612    64
    2548    64
    2484    64
    2420    64
    2355    65

能量护盾如果抵消物理伤害152.xx~153,再抵消火伤47.xx~47,最后抵消冰。剩下火焰伤害170-47.xx~47=123~122.xx。火吸收加血123~122.xx，16.xx~17+170-123~122.xx=63.xx~65.xx。火伤吸收优先于冰。

::

    测试4
    bar 同上
    sor 200法力开盾， 冰吸收200
    sor血    加血
    2386    31
    2416    30
    2446    30
    2476    30
    2506    30

确实先抵消了火伤害，200法力抵消完后，物理伤害和火伤害总和还有139.xx~140,170冰伤害给完全吸收，最后加血30~30.xx。

重复实验结果: 物理 > 火焰 > 闪电 > 冰 > 魔法

最后做个测试::

    bar 基础伤害1~2, 火170, 魔法伤害170
    sor 开盾牌，  火抗50%, mdr 60,  dr 60,
    按dr mdr 以及抗的计算顺序， 能量盾先吸收火再吸收魔法伤害
    法力先抵消掉0.xx物理攻击，然后抵消99.xx火伤害，
    剩下53.xx+17火伤害, 再算mdr, 各抵消60点火和60点魔法伤害
    剩下10.xx点火伤害，110点魔法伤害，抗性50%火， 剩下5.xx点火伤害，
    然后算dr, 剩下5.xx火伤害+110魔法伤害-60dr=55.xx伤害，

::

    sor血    掉血
    3454    55
    3399    55
    3344    55
    3288    56
    3233    55

结果完全符合。
