一. 什么是TC
什么是TC？这个问题很难回答。按照字面翻译，TC=Treasure Class=财宝阶层、财宝级别，其实就是怪物能够掉落物品类型的一个集合。TC 并不是将物品按外观, 用途分类, 而是按物品的珍贵程度分类. 所有的 TC 共同组成 TC 系统. 游戏用 TC 系统来决定每个怪物能掉什么物品。

二. TC 系统的形象认识
  TC 系统是庞大而复杂的. 你可以将 TC 系统想象成一棵倒置的树, 树的每个分枝处就是 TC 系统中的一个结点, 每个结点对应一个 TC, TC 可以包含子TC. 不过, 用树来比喻 TC 系统是不准确的, 因为树形系统中, 每个结点只有一个父结点, 而 TC 系统中, 每个 TC 可能有多个父 TC. 树形结构能帮助你对 TC 系统有一个形象的认识, 但是请记得 TC 系统不是树形系统.
  每个怪物各对应一个TC，怪物死的瞬间，将从该TC内按照设定好的几率随机选取某几个类型的物品掉落；若随机到了NoDrop，则不掉物品。

三. TC 的命名规则
TC在游戏内的TreasureClassEx.txt内设定，命名规则为"Act "+act_number+" "+difficulty_code{"","(N)","(H)"}+" TC_Type "+area_code{"A","B","C"}。比如，地狱难度下act3的怪物可能有以下几个TC：Act 3 (H) H2H A, Act 3 (H) Cast B, Act 3 (H) Miss C, etc.

四. TC 的组成
单单得到一个名称，我们并不能知道这是什么意思。具体TC都包含了什么？
1. pick值。这个pick值代表调用一次该TC时选择几次物品。
2. Nodrop参数。即每一次选择都有可能不掉东西。
3. 具体物品，以及该物品对应的几率参数。可能有好几个，也可能没有。
4. 子TC，以及该子TC对应的几率参数。即一次TC选择时可能会选择到其子TC，并进入嵌套选择。
==========================================================
各物品类型均按照一定原则分类归入各TC。
对于武器、防具等有Qlvl(品质等级)的物品，每3个Qlvl归入一个weapXX，armorXX等类似的TC，XX代表数字，3-87，均为3的倍数。Qlvl1-3归入weap3或者armor3，Qlvl4-6归入weap6或者armor6，以此类推。详见物品Qlvl一览。
对于没有Qlvl的物品，则分几个类别归入几个TC。以Rune为例，r1、r2归入Runes 1，r3、r4和Runes 1归入Runes 2，依此类推。r33和Runes 16归入Runes 17。
所有这些WeapXX armorXX BowXX RuneXX 等最终归入前边提到的ActX (H) XX A等TC。怪物直接对应的TC就是类似ActX (H) XX A之类的TC。

五. 怪物TC随等级的调整
由上文我们可以知道，普通怪物的级别是按照一定规则随场景等级调整的。而它的TC也会随级别调整。调整规则如下：
1. 获取怪物的初始TC。
2. 查TC列表，得到该TC的Group值。
3. 选择与该TC同一Group、并且满足level<=Mlvl(怪物级别)的level最大的TC作为该怪物的实际TC。
可能有点拗口，举例说明下吧。比如噩梦难度的古难记录者。查怪物和场景等级知毁灭王座为66场景，古难级别为66+3=69，噩梦难度对应的TC为Act 5 (N) Champ C.

查TC列表得Act 5 (N) Champ C对应的Group13中，级别小于等于69的TC，level最大的是Act 2 (H) Champ A。即噩梦难度古难记录者的实际TC为Act 2 (H) Champ A。

注：这里有两个特例。牛的TC是Cow (H)，这个TC group和TC level的值都为空值，也就是只有这一个TC；议会成员的TC为Council (H)，该TC的TC group和TC level的值也都为空值。因此，这两类怪物的TC不会随场景等级提升。
怪物的初始TC可参看全怪物资料。TC列表请看1楼的附件。

六. TC的一般选择过程
怪物被杀死的瞬间，系统会依据pick数值来确定选择几次。每次的流程都相同。
1. 计算总几率参数，即将TC中各几率参数求和。
2. 按照各部分的几率参数占总几率参数和的比例随机选择。类似于掷骰子，只不过这个骰子的面比较多。
3.
 3.1 若选择的结果是 NoDrop, 则此次选择结束。若选择次数小于pick，继续下一次选择。
 3.2 若选择的结果是 金币, 就掉一些金币, 此次选择结束. 若选择次数未到，继续下一次选择。
       金币在TC列表中的表示方法为"gld,mul=1280"，其中1280为举例，可为其他数字。
          金币的基础掉落数值为：Mlvl ~ (6*Mlvl-1)，随机选择。其中Mlvl为掉落金币的怪物等级。
          确定基础数值后，乘以倍数：mul/256
 3.3 具体到WeapXX或者ArmorXX等TC时，同一TC内的物品选择几率满足：
       3.3.1 所有物品被选择的几率相同。
       3.3.2 ASN爪子的选择几率有2/3的惩罚。
       3.3.3 其他角色专用装备以及手杖、法杖、权杖类选择几率有1/3的惩罚。
       选中某一具体物品后，进入成色判断步骤。参考怪物掉落过程的成色判断。
 3.4 若选择的结果是某个子 TC, 就进入那个子 TC 重复上面的步骤。
4. 若选择次数小于pick，继续下一次选择。
5. 全部选择结束，若掉落物品大于六件，则取前六件。
可见，这是一个递归调用过程。
注意这个过程选择的是物品类型，完全随机选择，这就是我们俗称的RP，跟MF数值没有丝毫关系。确定是否掉落符文也是在这个过程完成的。因此，掉落符文的几率跟MF值毫无关系。
————————————————————————————————————————————
如果pick<0，则按先后顺序分配原则来取代随机抽取原则。下面举例说明。
1.当│pick│＝prop1+....+propX时。（│pick│表示pick值的绝对值）
假设设置某TC的pick=-4，NoDrop=0，包含Item1-weap3和Item2-armo3的prop都为2。则
此时按照Item1和Item2的排列先后顺序来分配pick值，且优先满足位置靠前的物品代码或子TC。首先“Item1-weap3”分到了2个pick值，表示将要调用weap3这个TC2次；然后再分给“Item2-armo3”2个pick值，含义相同，调用armo3这个子TC2次。此时，pick值剩余值为0，该TC调用结束。
2.当│pick│＜prop1+....+propX时。
假设设置某TC的pick=-3，NoDrop=0，包含Item1-weap3和Item2-armo3的prop都为2。则
规则和1的情况是相同的。只有一处不同。pick值在“优先满足靠前位置的子TC”这个规则下，先分配给“Item1-weap3”2个pick值；然后将仅剩的1个pick值分给“Item2-armo3”，尽管“Item2-armo3”的prop值为2，但是它只分到了1个pick值，只会调用armo3这个TC1次。此时，pick值剩余值为0，该TC调用结束。

七. 举例
  上面的介绍很抽象, 现在举个例子来说明. 举地狱难度的 Mephisto 的 TC 为例子. 它的 TC 名叫 "Mephisto (H)". (这不是第一次杀地狱 Mephisto 的 TC, 第一次杀 Mephisto另有 TC.)
  "Mephisto (H)" 这个 TC 的组成如下:
  1. 选择数(Pick)为 7;
  2. NoDrop 的几率参数为 15;
  3. 包含的物品是金币, 几率参数为 15;
  4. 包含的子 TC 为:
      (1). "Act 4 (H) Equip A", 几率参数 52;
      (2). "Act 4 (H) Junk", 几率参数为 5;
      (3). "Act 4 (H) Good", 几率参数为3;
(注: 别被"Good"这个词骗了, 这里是货物的意思, 实际是珠, 宝石, 神符等.)
  Mephisto 被杀死后, 游戏首先确定要进行 7 次遍历. 每次的过程都相同:
  1. 计算总几率参数: 15+15+52+5+3 = 90
  2. 掷骰子. 这是个有 90 个面的骰子. 其中:
      NoDrop 占 15 个面;
      金币占 15 个面;
      "Act 4 (H) Equip A" 占 52 个面;
      "Act 4 (H) Junk" 占 5 个面;
      "Act 4 (H) Good" 占 3 个面.
  3.1 若掷骰子的结果是 NoDrop, 则此次遍历结束. 若遍历次数未到 7 次, 就进行下一次遍历;
  3.2 若掷骰子的结果是 金币, 就掉一些金币, 此次遍历结束. 若遍历次数未到 7 次, 就进行下一次遍历;
  3.3 若掷骰子的结果是某个子 TC, 就进入那个子 TC 重复上面的步骤(当然各个参数是取子TC的参数了).
  实际上, Mephisto 从不会掉出 7 件东西, 因为只取前 6 件. 由 TC 遍历选出的物品, 还要进行成色判断, 即是否暗金或绿色或亮金或蓝色等, 不在本文范围之内了.

八. 其它
  MF 的作用在哪?
  MF 作用于成色判断过程, 对 TC 无作用. 关于物品的成色判断请看怪物掉落过程的成色判断。
  人数影响 TC 的选择吗?
  是的. 人数仅影响 NoDrop 几率参数. 上面的例子只是单人游戏中的情况. 多人时, 参考多人游戏对物品掉落的影响。